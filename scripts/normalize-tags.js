const fs = require('fs');
const path = require('path');

// 새 태그 시스템 (약 30개로 압축)
// 각 테스트는 2-4개의 태그를 가지도록 함

// 태그 매핑 규칙 - 더 공격적으로 통합
const tagMapping = {
  // === 바이럴 (인기/자극적) ===
  '바이럴': '바이럴',
  '자극적': '바이럴',
  '인기': '바이럴',
  
  // === 재미 (유머/힐링 통합) ===
  '재미': '재미',
  '유머': '재미',
  '개그': '재미',
  '힐링': '재미',
  '위로': '재미',
  '치유': '재미',
  '추억': '재미',
  '빌런': '재미',
  '히어로': '재미',
  
  // === 성격 ===
  '성격': '성격',
  '성향': '성격',
  '유형': '성격',
  '페르소나': '성격',
  '이중인격': '성격',
  '성격변화': '성격',
  '첫인상': '성격',
  '이미지': '성격',
  '카리스마': '성격',
  '내향': '성격',
  '외향': '성격',
  '소셜배터리': '성격',
  
  // === MBTI ===
  'MBTI': 'MBTI',
  '부캐': 'MBTI',
  'DISC': 'MBTI',
  '에니어그램': 'MBTI',
  
  // === 심리 ===
  '심리': '심리',
  '심층분석': '심리',
  '무의식': '심리',
  '본성': '심리',
  '그림자': '심리',
  '욕망': '심리',
  '나르시시즘': '심리',
  '다크 트라이어드': '심리',
  '내면아이': '심리',
  '정신연령': '심리',
  '자존감': '심리',
  '완벽주의': '심리',
  '피플플리저': '심리',
  '눈치': '심리',
  '집착': '심리',
  '질투': '심리',
  '독립': '심리',
  '자립': '심리',
  '의존': '심리',
  '호기심': '심리',
  '탐구심': '심리',
  '낙관': '심리',
  '비관': '심리',
  '긍정': '심리',
  '직관': '심리',
  '육감': '심리',
  '예민함': '심리',
  'HSP': '심리',
  '결단력': '심리',
  '의사결정': '심리',
  '인내심': '심리',
  '정체성': '심리',
  '젠더': '심리',
  
  // === 감정/멘탈 ===
  '감정': '멘탈',
  '감성': '멘탈',
  '멘탈': '멘탈',
  '스트레스': '멘탈',
  '번아웃': '멘탈',
  '불안': '멘탈',
  '분노': '멘탈',
  '회복탄력성': '멘탈',
  '정신건강': '멘탈',
  '월요병': '멘탈',
  
  // === 두뇌/IQ ===
  'IQ': '두뇌',
  '지능': '두뇌',
  '두뇌': '두뇌',
  '논리': '두뇌',
  '추론': '두뇌',
  '기억력': '두뇌',
  '집중력': '두뇌',
  '창의력': '두뇌',
  '상상력': '두뇌',
  '공간': '두뇌',
  '수학': '두뇌',
  '수리': '두뇌',
  '언어': '두뇌',
  '어휘': '두뇌',
  '패턴': '두뇌',
  '암기': '두뇌',
  '좌뇌': '두뇌',
  '우뇌': '두뇌',
  '논쟁': '두뇌',
  '학습': '두뇌',
  '생산성': '두뇌',
  
  // === EQ/공감 ===
  'EQ': 'EQ',
  '감성지능': 'EQ',
  '공감': 'EQ',
  
  // === 연애 ===
  '연애': '연애',
  '사랑': '연애',
  '데이트': '연애',
  '이상형': '연애',
  '매력': '연애',
  '유혹': '연애',
  '어필': '연애',
  '바람기': '연애',
  '솔직': '연애',
  '연인': '연애',
  
  // === 커플 ===
  '커플': '커플',
  '애정': '커플',
  '온도': '커플',
  '싸움': '커플',
  '결혼': '커플',
  '동거': '커플',
  '궁합': '커플',
  
  // === 썸 ===
  '솔로': '썸',
  '썸': '썸',
  '짝사랑': '썸',
  '호감': '썸',
  '고백': '썸',
  '밀당': '썸',
  '소개팅': '썸',
  
  // === 이별 ===
  '이별': '이별',
  '미련': '이별',
  '전애인': '이별',
  '재회': '이별',
  '회복': '이별',
  '트라우마': '이별',
  
  // === 관계 ===
  '관계': '관계',
  '대인관계': '관계',
  '친구': '관계',
  '우정': '관계',
  '가족': '관계',
  '독성': '관계',
  '가스라이팅': '관계',
  '레드플래그': '관계',
  '갈등': '관계',
  '신뢰': '관계',
  
  // === 소통 ===
  '소통': '소통',
  '대화': '소통',
  '표현': '소통',
  '칭찬': '소통',
  '사과': '소통',
  '협상': '소통',
  
  // === 직장 ===
  '직장': '직장',
  '직장인': '직장',
  '회의': '직장',
  '회식': '직장',
  '리더십': '직장',
  '상사': '직장',
  '동료': '직장',
  '팀워크': '직장',
  '협업': '직장',
  '업무': '직장',
  '워라밸': '직장',
  '재택근무': '직장',
  '리모트': '직장',
  '퇴사': '직장',
  '회사': '직장',
  
  // === 커리어 ===
  '커리어': '커리어',
  '직업': '커리어',
  '적성': '커리어',
  '진로': '커리어',
  '취업': '커리어',
  '면접': '커리어',
  '자기소개': '커리어',
  '재능': '커리어',
  '잠재력': '커리어',
  '스타트업': '커리어',
  '창업': '커리어',
  '부업': '커리어',
  'N잡': '커리어',
  
  // === 재테크 ===
  '돈': '재테크',
  '재테크': '재테크',
  '소비': '재테크',
  '부자': '재테크',
  '금전': '재테크',
  '쇼핑': '재테크',
  '플렉스': '재테크',
  '마인드': '재테크',
  '마인드셋': '재테크',
  
  // === 라이프 ===
  '라이프': '라이프',
  '라이프스타일': '라이프',
  '습관': '라이프',
  '일상': '라이프',
  '생활': '라이프',
  '루틴': '라이프',
  '미루기': '라이프',
  '정리': '라이프',
  '청소': '라이프',
  '방': '라이프',
  '수면': '라이프',
  '아침형': '라이프',
  '저녁형': '라이프',
  '생체리듬': '라이프',
  '건강': '라이프',
  '홈바디': '라이프',
  '집돌이': '라이프',
  '집순이': '라이프',
  '휴식': '라이프',
  '휴가': '라이프',
  '주말': '라이프',
  
  // === 취향 ===
  '취향': '취향',
  '스타일': '취향',
  '취미': '취향',
  '여행': '취향',
  '음식': '취향',
  '야식': '취향',
  '맛집': '취향',
  '간식': '취향',
  '요리': '취향',
  '음악': '취향',
  '플레이리스트': '취향',
  '영화': '취향',
  '드라마': '취향',
  '넷플릭스': '취향',
  '콘텐츠': '취향',
  '장르': '취향',
  '패션': '취향',
  '옷': '취향',
  '카페': '취향',
  '커피': '취향',
  '술자리': '취향',
  '노래방': '취향',
  '노래': '취향',
  '운전': '취향',
  '드라이브': '취향',
  
  // === 트렌드 ===
  'MZ': '트렌드',
  '트렌드': '트렌드',
  '세대': '트렌드',
  '알파세대': '트렌드',
  '신조어': '트렌드',
  '아재': '트렌드',
  '힙스터': '트렌드',
  '꼰대': '트렌드',
  '격차': '트렌드',
  
  // === SNS/디지털 ===
  'SNS': 'SNS',
  '소셜미디어': 'SNS',
  '인스타': 'SNS',
  '디지털': 'SNS',
  '테크': 'SNS',
  '유튜버': 'SNS',
  '크리에이터': 'SNS',
  '스마트폰': 'SNS',
  '인터넷': 'SNS',
  '앱': 'SNS',
  '미디어': 'SNS',
  '뉴스': 'SNS',
  '카톡': 'SNS',
  '문자': 'SNS',
  '이메일': 'SNS',
  '북마크': 'SNS',
  '비밀번호': 'SNS',
  '보안': 'SNS',
  '셀카': 'SNS',
  '사진': 'SNS',
  '밈': 'SNS',
  '관종': 'SNS',
  '관심': 'SNS',
  '중독': 'SNS',
  '디톡스': 'SNS',
  
  // === 판타지 ===
  '판타지': '판타지',
  '마법': '판타지',
  '동화': '판타지',
  '신화': '판타지',
  '해리포터': '판타지',
  '호그와트': '판타지',
  '초능력': '판타지',
  '슈퍼파워': '판타지',
  '신비': '판타지',
  '속성': '판타지',
  '에너지': '판타지',
  
  // === 운세 ===
  '운세': '운세',
  '타로': '운세',
  '전생': '운세',
  '오라': '운세',
  '인생': '운세',
  '시간여행': '운세',
  '역사': '운세',
  '2025': '운세',
  '새해': '운세',
  '크리스마스': '운세',
  '연말': '운세',
  '결산': '운세',
  '시즌': '운세',
  '계절': '운세',
  '봄여름가을겨울': '운세',
  '겨울': '운세',
  '날씨': '운세',
  '비': '운세',
  
  // === 게임 ===
  '게임': '게임',
  '캐릭터': '게임',
  '서바이벌': '게임',
  '좀비': '게임',
  '무인도': '게임',
  '종말': '게임',
  '생존': '게임',
  '아이돌': '게임',
  'K-POP': '게임',
  '학교': '게임',
  
  // === 동물 ===
  '동물': '동물',
  '반려동물': '동물',
  '펫': '동물',
  
  // === 삭제 (너무 일반적이거나 중복) ===
  '자기이해': null,
  '자기관리': null,
  '자가진단': null,
  '행동': null,
  '분석': null,
  '원인': null,
  '가능성': null,
  '준비': null,
  '측정': null,
  '점수': null,
  '레벨': null,
  '지수': null,
  '역할': null,
  '포지션': null,
  '타이밍': null,
  '적합도': null,
  '감별': null,
  '위험': null,
  '성공률': null,
  '연애준비': null,
  '새연애': null,
  '세포': null,
  '추천': null,
  '이름': null,
  '영어이름': null,
  '매칭': null,
  '정보': null,
  '감각': null,
  '환경': null,
  '가치관': null,
  '계획': null,
  '적응력': null,
  '체력': null,
  '전투력': null,
  '점심': null,
  '줄서기': null,
  '기다림': null,
  '아침': null,
  '지각': null,
  '약속': null,
  '민감도': null,
  '소음': null,
  '비밀': null,
  '색깔': null,
  'AI': null,
  '룸메이트': null,
  '비즈니스': null,
};

// 파일 읽기
const filePath = path.join(__dirname, '../src/lib/data.ts');
let content = fs.readFileSync(filePath, 'utf8');

// tags: [...] 패턴 찾아서 변환
const tagRegex = /tags:\s*\[([^\]]+)\]/g;

const allOriginalTags = new Set();
const allNewTags = new Set();

content = content.replace(tagRegex, (fullMatch, tagContent) => {
  // 기존 태그 파싱
  const oldTags = tagContent
    .split(',')
    .map(t => t.trim().replace(/['"]/g, ''))
    .filter(t => t);
  
  oldTags.forEach(t => allOriginalTags.add(t));
  
  // 새 태그로 변환
  const newTagsSet = new Set();
  
  oldTags.forEach(tag => {
    const mapped = tagMapping[tag];
    if (mapped !== undefined) {
      if (mapped !== null) {
        newTagsSet.add(mapped);
      }
    } else {
      // 매핑에 없으면 그대로 유지 (나중에 확인 필요)
      newTagsSet.add(tag);
    }
  });
  
  // 최대 4개 태그로 제한, 바이럴 우선
  let newTags = Array.from(newTagsSet);
  
  // 바이럴이 있으면 맨 앞으로
  if (newTags.includes('바이럴')) {
    newTags = ['바이럴', ...newTags.filter(t => t !== '바이럴')];
  }
  
  newTags = newTags.slice(0, 4);
  
  newTags.forEach(t => allNewTags.add(t));
  
  return `tags: [${newTags.map(t => `'${t}'`).join(', ')}]`;
});

// 파일 저장
fs.writeFileSync(filePath, content, 'utf8');

console.log('=== 태그 변환 완료 ===');
console.log('\n기존 태그 수:', allOriginalTags.size);
console.log('새 태그 수:', allNewTags.size);
console.log('\n새 태그 목록 (가나다순):');
console.log(Array.from(allNewTags).sort().join(', '));
